---
title: 加密的那些事
date: 2024-05-31 10:20:16
permalink: /pages/07c91f/
titleTag: 原创
categories:
  - 技术
  - 心得
tags:
  -
author:
  name: Regulus
  link: https://github.com/linxi0551
---

::: tip 序言

不论是前端还是后端开发中，数字签名、信息加密是经常需要使用到的技术，应用场景包括了用户登入、交易、信息通讯、OAuth 等等，不同的应用场景也会需要使用到不同的签名加密算法，或者需要搭配不一样的 签名加密算法 来达到业务目标。

:::

<!--
[幻灯片模式](/slides/slides.html) -->

[幻灯片模式](/pages/07c911/)

<!-- <script>
  window.location.href = '/slides/slides.html';
</script> -->

## 历史上的密码

<!-- **漫画**：https://cloud.tencent.com/developer/article/1394806 -->

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/04/zbw5goanfw.jpg' width="700" style="cursor: zoom-in;"></p>

早在古罗马时期，加密算法就被应用于战争当中。 在大规模的战争中，部队之间常常需要信使往来，传递重要的军事情报。

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/03/s81l0wvnzd.jpg' width="700" style="cursor: zoom-in;"></p>

可是，一旦信使被敌军抓获，重要的军事情报就完全暴露给了敌方。

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/03/thtjd7mn2l.jpg' width="700" style="cursor: zoom-in;"></p>

甚至，狡猾的敌人有可能篡改军事情报，并收买信使把假情报传递给我方部队。

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/03/5rl2i6buw1.jpg' width="700" style="cursor: zoom-in;"></p>

<!-- <p class="centered"><img src='https://ask.qcloudimg.com/http-save/yehe-2960417/5rl2i6buw1.jpeg?imageView2/2/w/1620' width="700" style="cursor: zoom-in;"></p> -->

### 凯撒密码

传送情报过程中，容易遭到**中间人攻击**，怎样防止这种情况的发生呢？ 古罗马时期，凯撒大帝想出了一种非常朴素的加密方法，这套加密方法也被后世称为**凯撒密码**。加密的原理就像下图这样：

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/04/ltlt3t6nuf.png' width="700" style="cursor: zoom-in;"></p>

原理其实非常简单，就是把字母表进行**移位加密**，比如将字母表中的 A 移位加密后变成 C，将字母表中的 B 移位加密后变成 D，以此类推。

<center><strong><big> 下面是更直观的示例 </big></strong></center>

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/03/_20240603113844.png' width="620" style="cursor: zoom-in;"></p>

**凯撒密码**在当时是一种有效的加密方法，它是典型的**对称加密**算法，它的加密和解密密钥用的都是同一个密钥，加密的时候字母表平移了几位，解密的时候只要反向平移就能得到原文。

这也导致凯撒密码的**安全性较低**，因为只需尝试 26 个不同的位移就能<span style="color:red;">暴力破解</span>。

<center><strong><big> 下面是暴力破解凯撒密码的示例 </big></strong></center>

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/03/_20240603140434.png' width="620" style="cursor: zoom-in;"></p>

### 栅栏密码

栅栏密码比凯撒密码年轻了许多，它最早出现在 1861 年至 1865 年的美国南北战争时期。和凯撒密码的**代替密码**不同，栅栏密码属于**置换密码**，通过打乱明文字母的位置，使有意义的明文信息变换为无意义的密文乱码。

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/03/54912907a9dc48bd85748d1d2f5940c1.webp' width="700" style="cursor: zoom-in;"></p>

它的加密的原理就是明文按列写入，密文按行输出。

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/03/640.webp' width="200" style="cursor: zoom-in;"></p>

假设有一明文：**HAPPY NEW YEAR**，首先给它分栏，把明文一上一下分成 N 个一栏，这里分成两栏
| H | P | Y | E | Y | A |
| :---- | :--- | :--- |:---- | :--- |:--- |
| A | P | N | W | E | R |

把每栏的字母横向连起来，就形成一段看起来毫无意义的密文：**HPYEYAAPNWER**

解密的时候只要把密文**HPYEYAAPNWER**从中间分开，再按上下上下的顺序组合起来就能得到明文： **HAPPY NEW YEAR**

### 斯巴达密码棒

在古希腊，斯巴达军方使用一种叫做密码棒的装置来加密信息，这种装置由一条皮带和一根木棍组成。 在展开时，皮带似乎只是一串随机字符，但如果缠绕在一定大小的木棒上，字母会对齐成单词。

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/05/_20240705111404.png' width="700" style="cursor: zoom-in;"></p>

柯南中的密码棒灵感就来源于此。

<p class="centered" ><img src='https://tuchuang.voooe.cn/images/2024/07/05/ff2604a724b43164231291ba156f072.png' width="500" style="cursor: zoom-in;"></p>

在古典密码时代，密码学的概念还是比较模糊的，尽管大量被用在军事领域，但加密方式更像是一种艺术行为，反正就一个理念，瞎换乱转，你猜去吧 。

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/04/006r3PQBjw1fa7r9dzt46j3064064dfw.jpg' width="200" style="cursor: zoom-in;"></p>

而在我国古代也有藏头诗、藏尾诗，比如广为人知的唐伯虎写的"我爱秋香"

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/05/6abdd46d80b33eed2cfcf7c2b266507.png' width="600" style="cursor: zoom-in;"></p>

<center><big>
      <strong>我</strong>画蓝江水悠悠，
      <br>
      <strong>爱</strong>晚亭上枫叶愁。
      <br>
      <strong>秋</strong>月溶溶照佛寺，
      <br>
      <strong>香</strong>烟袅袅绕经楼。
</big></center>

也有先秦兵书《六韬》中提到的阴符。

<div class="image-container">
    <div class="image-wrapper">
        <img src='https://tuchuang.voooe.cn/images/2024/07/04/1310e75fb41e95452ac64521788477a.png' width="150" style="cursor: zoom-in;">
        <p class="caption">六韬</p>
    </div>
</div>
<div class="image-container">
    <div class="image-wrapper">
        <img src='https://tuchuang.voooe.cn/images/2024/07/04/ed57b26db10918d75f732a0ab891b1d.png' width="200" style="cursor: zoom-in;">
        <p class="caption">阴符</p>
    </div>
</div>
<div class="image-container">
    <div class="image-wrapper">
        <img src='https://tuchuang.voooe.cn/images/2024/07/05/3be0c95d6881e2244aae2cb2c20286e.png' width="300" style="cursor: zoom-in;">
        <p class="caption">越长战绩越好</p>
    </div>
</div>

阴符的**优点**：便于携带且不易引起敌方怀疑

阴符的**缺点**：传递的信息量很少

在《六韬》的龙韬篇中，有记载：

::: details 点开查看原文

武王问太公："率领军队深入敌国境内，国君与主将想要集结兵力，根据敌情进行灵活的机动。用阴符难以说明问题，彼此相距又十分遥远。在这种情况下应该怎么办？"

太公回答："用阴书，就是把一封书信分为三个部分；然后派三个人送信，每人只有其中的一部分，即使送信的人也不知道书信的内容。这样，即使敌人抓了信使，也是不知道书信的内容。"

武王曰:"高明啊!"

:::

<div class="image-container">
    <div class="image-wrapper">
        <img src='https://tuchuang.voooe.cn/images/2024/07/05/acbef3f06c556d0f74577c8395b14d4.png' width="300" style="cursor: zoom-in;">
        <p class="caption">一分为三的阴书</p>
    </div>
</div>


除此之外还有很多好玩的古典密码,这里就不一一细说了，古典密码都有一个共同点，那就是**太对称了**，这里说的对称有两种含义：

第一种：加密是可逆的，一旦知道怎样加密，就很容易反推出怎么解密。

所以古人只要随便抓个活口就知道密码是怎么玩的，他们并不傻。

 <p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/05/0b77cf8bd3166575cd09b0fdf11501f.png' width="400" style="cursor: zoom-in;"></p>


另一种对称的意思是：不管你如何对明文进行替换，总会形成一种明文和密文的一一对应关系。

  <p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/08/59e78f8dbf24db773aa60d25c88a760.png' width="500" style="cursor: zoom-in;"></p>

  <p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/08/28da1b2e8aa416c59d6af45f0ad2c31.png' width="500" style="cursor: zoom-in;"></p>

  <p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/08/82fd9a0009d56a03e16d7de8c7ec2eb.png' width="500" style="cursor: zoom-in;"></p>

因此不管怎么替换，只要被截获的密文一多，总会被频率分析法拿捏。


<div class="image-container">
    <div class="image-wrapper">
        <img src='https://tuchuang.voooe.cn/images/2024/07/08/4f649f093dd6f80713a1a895839923d.png' width="300" style="cursor: zoom-in;">
        <p class="caption">  英语字母频率统计</p>
    </div>
</div>


## 恩尼格玛机

古典密码的巅峰之作恩尼格玛机，是由德国发明并在二战期间广泛使用的加密和解密机器，又称作哑谜机，或"谜"式密码机。

 <p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/09/d9df8e080dd24fe6aa9da728217e648.png' width="400" style="cursor: zoom-in;"></p>

恩格玛机的伟大之处就在于它在进行高度复杂的加密运算的同时，操作的简易性也几乎做到了极致。

操作者只需像使用打字机一样在键盘上输入消息，加密后的字母就会在灯盘上显示出来，这使得即使是未经专业训练的人员也能快速上手。

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/09/02ae90d344e982c9771629088ccfa0b.png' width="500" style="cursor: zoom-in;"></p>

而且明文中相同的字母也会被**加密成不同的密文**，这就很好的防止了频率分析法，另外即使知道其运作原理也很难破解。

这是如何做到的？

 <p  class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/09/15f5170a-bc53-4cea-81e6-786f4d2361bb.jpg' width="300" style="cursor: zoom-in;"></p>

首先先看下恩尼格玛机的组成部件

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/08/_20240708175116.png' width="500" style="cursor: zoom-in;"></p>

  **键盘**：输入明文或者密文用的

  **灯盘**：在键盘上输入一个字母，灯盘上会有一个字母亮起来，代表键盘上输入的字母加密后的结果

  **转子**：这个是恩格玛机的核心，是加密元件

  **插线板**：这是在转子进行加密后，为了提高安全性而增加的装置

之所以恩尼格玛机在当时很难破解，主要还是因为它的核心元件"转子"。

<div class="image-container">
    <div class="image-wrapper">
<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/09/13f0785b6bed27a999cff630240a3b1f_hd.jpg' width="300" style="cursor: zoom-in;"><img src='https://tuchuang.voooe.cn/images/2024/07/09/f49c8d2aff0678220d15dc71d7105233_hd.jpg' width="300" style="cursor: zoom-in;"></p>
        <p class="caption">转子</p>
    </div>
</div>

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/08/f2ba52588641e0732334271c871c821.png' width="500" style="cursor: zoom-in;"></p>

转子就像是可以旋转的密码锁，比如当你按下"A"键时，"A"通过转子时，它会被替换成另一个字母，比如"D",但是，神奇的地方在于，当你再次按下"A"键时，由于转子已经旋转，它可能变成"E"或另一个字母，而不是"D"。这是因为每次按键后，转子都会转动，改变内部的连接，所以同一个字母可以被替换成不同的字母。

<p class="centered" ><img src='https://tuchuang.voooe.cn/images/2024/07/09/e093f1e976540c1c8118e24be63a228.png' width="500" style="cursor: zoom-in;"></p>

一台恩尼格玛机通常使用了三个转子串联起来，有时更多,当一个转子转完一圈，它会推动下一个转子转动一点。

这意味着，随着输入更多的字母，转子的组合方式会变得极其复杂，使得相同的字母在不同的位置被替换成不同的字母。

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/09/gif_QQ20240709163627_2024070916380595.gif' width="500" style="cursor: zoom-in;"></p>

由于每个转子都有26个可能的位置，所以三个转子一共可以提供**26 X 26 X 26=17576**种可能性。

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/11/222bc15f8af8ba7e60ad31e836cf0a99_hd.jpg' width="500" style="cursor: zoom-in;"></p>

恩格玛机除了转子，还有个重要装置：反射器。

性质一：加密过程是自反的。

解释：假如输入"A"输出"G"，反过来，输入"G"将会输出"A",这样既可以用来加密也可以用来解密。

性质二：一个字母加密后的输出结果不会是自己本身。

解释：一个字母如果加密后要还是自己，在图中就会变成"A"从红线进去，然后从红线再返回来，但是经过反射器，导致"A"的返回路径是蓝线，所以字母加密后结果不是其本身。

 <p class="centered" ><img src='https://tuchuang.voooe.cn/images/2024/07/09/1.gif' width="700" style="cursor: zoom-in;"></p>

除此之外，为了保险起见它的外侧还附加一组交换机制"插线板"，也就是说如果连通"O"和"E"，当按下"O"时，其实相当于按下了"E"，这种连线最多可以有六根。

插线板上两两交换6对字母的可能性则是异常庞大，有**100,391,791,500**种。

最终 17576 X 100391791500 = **1764486127404000** 种。

在没有计算机时代，想通过逆向穷举的方式几乎是不可能的！

<p  class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/10/20200227112318887.png' width="300" style="cursor: zoom-in;"></p>

况且当时的恩尼格玛机每天都会更换一次初始方案

<div class="image-container">
    <div class="image-wrapper">
<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/10/1.png' width="300" style="cursor: zoom-in;"></p>
        <p class="caption">第一天</p>
    </div>
</div>

<div class="image-container">
    <div class="image-wrapper">
<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/10/2.png' width="300" style="cursor: zoom-in;"></p>
        <p class="caption">第二天</p>
    </div>
</div>

<div class="image-container">
    <div class="image-wrapper">
<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/10/3.png' width="300" style="cursor: zoom-in;"></p>
        <p class="caption">第三天</p>
    </div>
</div>

<div class="image-container">
    <div class="image-wrapper">
<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/10/4.png' width="300" style="cursor: zoom-in;"></p>
        <p class="caption">第四天</p>
    </div>
</div>

如果当天算不出，第二天就得重新计算，这使得暴力破解又更难了。
 <p class="centered" ><img src='https://tuchuang.voooe.cn/images/2024/07/10/u26898724423734607591fm253fmtautoapp138fJPEG.webp' width="400"  style="cursor: zoom-in;"></p>

 但了解二战的小伙伴都知道，恩尼格玛机最终还是被**破解**了,甚至没等到计算机的诞生。

1940年，计算机之父英国数学家艾伦·图灵就破解了恩尼格玛机。不是说恩尼格玛机没有计算机就无法破解的吗？

 <p class="centered" ><img src='https://tuchuang.voooe.cn/images/2024/07/10/38362ad137253af3146a8e7034abcf4.png' width="400"  style="cursor: zoom-in;"></p>

 说法虽没错，但遭不住德国人太轴又太飘。

 <p class="centered" ><img src='https://tuchuang.voooe.cn/images/2024/07/10/xtl.gif' width="700"  style="cursor: zoom-in;"></p>

不管发啥都要来一句Heil Hitler！
 <p class="centered" ><img src='https://tuchuang.voooe.cn/images/2024/07/11/92e358746ae07d621398a4e3a075dc9.png'  style="cursor: zoom-in;"></p>
 <p class="centered" ><img src='https://tuchuang.voooe.cn/images/2024/07/11/35b376f3899019a1385252f03f8a6bc.png'  style="cursor: zoom-in;"></p>
 <p class="centered" ><img src='https://tuchuang.voooe.cn/images/2024/07/11/1dfabefe236a0aa384fa00c170a5ebf.png'  style="cursor: zoom-in;"></p>
 <p class="centered" ><img src='https://tuchuang.voooe.cn/images/2024/07/11/eab9ee975c5669d97edb034d16f4036.png'  style="cursor: zoom-in;"></p>

这种严谨又白给的操作，很快就让图灵拿到了明密对应的线索。
<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/07/12/image44213bfea108147d.png' width="238"  style="cursor: zoom-in;"></p>

依靠这些线索图灵和他的同事戈登·韦尔奇曼发明了叫做"炸弹机"的解密机。

<div class="image-container">
    <div class="image-wrapper">
        <img src='https://tuchuang.voooe.cn/images/2024/07/10/v2-6ee378fc707312b6a7ea7fda139802a8_720w.webp' width="300" style="cursor: zoom-in;">
        <p class="caption">图灵</p>
    </div>
    <div class="image-wrapper">
        <img src='https://tuchuang.voooe.cn/images/2024/07/12/3a9bb1e13e7de6cd25c055ab8560585.png' width="255" style="cursor: zoom-in;">
        <p class="caption">戈登·韦尔奇曼</p>
    </div>
</div>

<div class="image-wrapper">
        <img src='https://tuchuang.voooe.cn/images/2024/07/12/image.png' width="255" style="cursor: zoom-in;">
        <p class="caption">炸弹机</p>
    </div>

通过"炸弹机"最后硬生生的逆向破解了恩尼格玛机。

所以这又一次说明了像古典密码这样，知道怎么加密就能知道怎么解密的对称加密方法，从根本上来说是肯定会被破解的，只不过是时间问题罢了。

<p class="image-wrapper" ><img src='https://tuchuang.voooe.cn/images/2024/07/12/035c0f8e65024f30a4a57207b235416a.gif' width="400" style="cursor: zoom-in;"></p>

::: warning 那有没有哪种加密方式，加密和解密方法不一样？
:::

## 现代密码

#### 一点历史

::: tip 1976 年以前，所有的加密方法都是同一种模式：

1. 甲方选择某一种加密规则，对信息进行加密

2. 乙方使用同一种规则，对信息进行解密
   :::

由于加密和解密使用同样规则（简称"密钥"），这被称为["对称加密算法"](http://zh.wikipedia.org/zh-cn/%E5%AF%B9%E7%AD%89%E5%8A%A0%E5%AF%86)（Symmetric-key algorithm）。

这种加密模式有一个最大弱点：甲方必须把加密规则告诉乙方，否则无法解密。保存和传递密钥，就成了最头疼的问题。

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/12/bg2013062703.jpg' width="500" style="cursor: zoom-in;"></p>

1976 年，两位美国计算机学家 Whitfield Diffie 和 Martin Hellman，提出了一种崭新构思，可以在不直接传递密钥的情况下，完成解密。这被称为["Diffie-Hellman 密钥交换算法"](http://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange)。这个算法启发了其他科学家。人们认识到，加密和解密可以使用不同的规则，只要这两种规则之间存在某种对应关系即可，这样就避免了直接传递密钥。

这种新的加密模式被称为"非对称加密算法"。
::: tip 工作流程
（1）乙方生成两把密钥（公钥和私钥）。公钥是公开的，任何人都可以获得，私钥则是保密的。

（2）甲方获取乙方的公钥，然后用它对信息加密。

（3）乙方得到加密后的信息，用私钥解密。
:::
如果公钥加密的信息只有私钥解得开，那么只要私钥不泄漏，通信就是安全的。

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/12/bg2013062702.jpg' width="500" style="cursor: zoom-in;"></p>

1977年，三位数学家 Rivest（罗纳德·李维斯特）、Shamir（阿迪·萨莫尔） 和 Adleman（伦纳德·阿德曼） 设计了一种算法，可以实现非对称加密。这种算法用他们三个人的名字命名，叫做[RSA 算法](http://zh.wikipedia.org/zh-cn/RSA%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95)。从那时直到现在，RSA 算法一直是最广为使用的"非对称加密算法"。毫不夸张地说，只要有计算机网络的地方，就有 RSA 算法。

下面用一个箱子的对白来理解这个**对称加密**和**非对称加密**的流程。

  <p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/08/05/image.png' width="400" style="cursor: zoom-in;"></p>

  <p  class="centered"><img src='https://tuchuang.voooe.cn/images/2024/08/05/imaged9d7cee4bce9a7ec.png' width="400" style="cursor: zoom-in;"></p>

  <p  class="centered"><img src='https://tuchuang.voooe.cn/images/2024/08/05/image74935d4208fba8d8.png' width="400" style="cursor: zoom-in;"></p>

  <p  class="centered"><img src='https://tuchuang.voooe.cn/images/2024/08/05/image8efcb5f52a215413.png' width="400" style="cursor: zoom-in;"></p>

  <p  class="centered"><img src='https://tuchuang.voooe.cn/images/2024/08/05/image76831a3e4a44c491.png' width="400" style="cursor: zoom-in;"></p>

  <p  class="centered"><img src='https://tuchuang.voooe.cn/images/2024/08/05/image5a7fbb6ee68895bc.png' width="400" style="cursor: zoom-in;"></p>

  <p  class="centered"><img src='https://tuchuang.voooe.cn/images/2024/08/05/image85519bb933e0b878.png' width="400" style="cursor: zoom-in;"></p>